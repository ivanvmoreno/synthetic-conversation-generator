## Technical Documentation for YAML Schema

This documentation describes the structure, logic, and components used in the YAML-based dialogue specification. 

The schema defines a conversational workflow between an HR agent and a candidate during a recruitment process. Below is a detailed explanation of each section and the general schema format used in the specification.

### 1. **Overview**
The YAML schema defines a step-by-step conversation flow, where:

- The **HR agent** initiates the interaction with the candidate.
- The conversation consists of several **nodes** with unique IDs.
- Each node is identified by the key `id` and contains actions and possible transitions to other nodes.
- The flow involves checking the candidate’s interest in a job opening, discussing their experience, prompting them to apply, and answering additional questions.
- Some nodes serve as **decision branches**, directing the flow based on the candidate's responses.
  
### 2. **Schema Components**

#### 2.1 **Nodes**
A node represents a specific stage in the conversation. Each node has the following structure:

- `id`: A unique identifier for the node.
- `initiator`: Indicates who is initiating the action in that node (either `agent` or `candidate`).
- `actions`: A list of actions performed in the node.
- `is_start` (optional): A boolean field that indicates whether the node is the starting point of the conversation. Defaults to `false`.
- `is_end` (optional): A boolean field that indicates whether the node ends the conversation. Defaults to `false`.
- `is_branch` (optional): A boolean field that indicates whether the node creates a decision point, directing the flow based on different responses. Defaults to `false`.
- `next`: Defines the next node(s) in the conversation flow. In a branching node, this will be a dictionary mapping specific responses to subsequent node IDs.

#### 2.2 **Actions**
Actions describe the specific steps or messages exchanged in the conversation. Each action has the following structure:

- `role`: Specifies who performs the action (`agent` or `candidate`).
- `action_type`: Defines the type of action, such as:
  - `template`: Predefined messages with placeholders for personalized content.
  - `message`: Custom messages exchanged between participants.
  - `response`: A reaction to a prompt or question.
- `description`: A brief description of the action's purpose.
- `example`: (For `template` or `message` actions) Provides an example of the message that is sent. Placeholders such as `{candidate[first_name]}` or `{agent[company_name]}` are used for dynamic content insertion.
  - In the case of `message` actions, the example is used as a one-shot example in the generation prompt.
- `response_type`: (For `response` actions) Defines the expected type of response.
  - `template`: A predefined response format. No LLM generation, only template matching.
  - `message`: A free-form text response. LLM generation is used to generate the response.
- `examples`: (For `response` actions) A dictionary mapping possible responses to example text. Used as either a one-shot example in the generation prompt or for template matching depending on the `response_type`.

#### 2.3 **Branching Logic**
Some nodes create decision branches where the conversation can proceed to different nodes based on the candidate’s response. This is handled via:

- `is_branch`: Set to `true` when the node serves as a decision point.
- `next`: A dictionary that maps specific response values to the next node ID (e.g., `yes`: `job_experience_question`, `no`: `goodbye`).

### 3. **Schema Example Walkthrough**

#### Example YAML Schema

```yaml
- id: introduction
  is_start: true
  initiator: agent
  actions:
    - role: agent
      action_type: template
      description: Initiate the conversation by introducing yourself, the HR agent, and the open position.
      example: |
        Hello {candidate[first_name]}, I'm {agent[first_name]}, a recruiter from {agent[company_name]}. I'm reaching out to discuss the open position for a {job_opening[title]}. Would you be interested in learning more about the role?
  next: interest_check

- id: interest_check
  initiator: candidate
  actions:
    - role: candidate
      action_type: response
      response_type: template
      description: Confirm if they are interested in the open position.
      examples:
        "yes": Hello {agent[first_name]}, yes, I would like to learn more about the role.
        "no": Hello {agent[first_name]}, thank you for reaching out, but I'm not interested in the position at this time.
  is_branch: true
  next:
    "yes": job_experience_question
    "no": goodbye

- id: job_experience_question
  initiator: agent
  actions:
    - role: agent
      action_type: message
      description: Ask the candidate about a past job experience relevant to the open position.
      example: |
        Sounds great! Can you tell me more about your experience working as a <job_title> at <company>? I see you have experience in <technologies>, which aligns well with the requirements for this role. Could you elaborate on your role and responsibilities?
    - role: candidate
      action_type: message
      description: Provide details about their job experience.
      example: |
        I worked as a <job_title> at <company>, where I was responsible for <responsibilities>. I used <technologies> to develop <specific_projects>. My experience in <specific_skills> helped me achieve <specific_results>.
  next: application_prompt

- id: application_prompt
  initiator: agent
  actions:
    - role: agent
      action_type: template
      description: Prompt the candidate to apply for the open position. Just a prompt, no additional questions.
      example: |
        Based on your experience, I believe you would be a good fit for the role. Would you like to apply for the position?
    - role: candidate
      action_type: response
      response_type: template
      description: Confirm whether or not they would like to apply for the open position.
      examples:
        "yes": Yes, I would like to apply for the position.
        "no": I'm sorry, but I'm not interested in applying at this time.
  is_branch: true
  next:
    "yes": additional_questions
    "no": goodbye

- id: additional_questions
  initiator: agent
  actions:
    - role: agent
      action_type: template
      description: Invite the candidate to ask any questions they may have about the position or the company.
      example: |
        Before I guide you to the next steps, do you have any questions about the role or the company?
    - role: candidate
      action_type: response
      description: Provide any questions that you as the candidate may have about the role or the company.
      examples:
        "yes": Yes, I have a few questions. Can you tell me more about <specific_topic>?
        "no": No, I don't have any more questions at the moment.
  is_branch: true
  next:
    "yes": additional_questions_followup
    "no": application_portal

- id: additional_questions_followup
  initiator: agent
  actions:
    - role: agent
      action_type: message
      description: Respond to the candidate's questions. Don't ask any additional questions.
      example: |
        Thank you for your questions. I'm happy to provide more information about <specific_topic>.
        <Provide additional information or guidance based on the candidate's questions.>
        Shall we proceed with the application process?
    - role: candidate
      action_type: message
      description: Confirm they are ready to proceed with the application process. Exclusively respond, no additional questions.
      example: |
        Thank you for the information. I'm ready to proceed with the application process.
  next: application_portal

- id: application_portal
  initiator: agent
  actions:
    - role: agent
      action_type: template
      description: Guide the candidate to the application portal or provide instructions on how to apply.
      example: |
        Great! To proceed with your application, please visit our application portal at {agent[career_site_url]}. You can submit your application and any additional documents there. Let me know if you need any assistance during the process.
    - role: candidate
      action_type: message
      description: Confirm that they will proceed with the application process.
      example: |
        Thank you for the information. I will visit the application portal and submit my application. If I have any questions, I'll reach out to you. Thank you for your time.
  next: goodbye

- id: goodbye
  initiator: agent
  actions:
    - role: agent
      action_type: message
      description: End the conversation with a closing message.
      example: |
        Thank you for your time {candidate[first_name]}. If you have any more questions, feel free to reach out. Have a great day!
  is_end: true
```

#### Node: **`introduction`**

- **Purpose**: Initiates the conversation between the agent and the candidate, introducing the open position.
- **Initiator**: The agent.
- **Actions**:
  - The agent uses a `template` message to introduce themselves and the open job position.
  - Example:
    ```yaml
    Hello {candidate[first_name]}, I'm {agent[first_name]}, a recruiter from {agent[company_name]}. I'm reaching out to discuss the open position for a {job_opening[title]}. Would you be interested in learning more about the role?
    ```
- **Next**: Leads to `interest_check` node.

#### Node: **`interest_check`**

- **Purpose**: Asks the candidate if they are interested in the job opening.
- **Initiator**: The candidate.
- **Actions**:
  - The candidate responds, using a `template`, with either interest (`yes`) or disinterest (`no`).
  - Examples:
    ```yaml
    "yes": Hello {agent[first_name]}, yes, I would like to learn more about the role.
    "no": Hello {agent[first_name]}, thank you for reaching out, but I'm not interested in the position at this time.
    ```
- **Branching**: 
  - If the candidate says "yes," the flow moves to `job_experience_question`.
  - If the candidate says "no," the flow moves to `goodbye`.

#### Node: **`job_experience_question`**

- **Purpose**: Asks the candidate about their past job experience.
- **Initiator**: The agent.
- **Actions**:
  - The agent asks a detailed question about the candidate’s relevant job experience using a `message`.
  - The candidate provides details about their experience using a `message`.
  - Example for the agent:
    ```yaml
    Sounds great! Can you tell me more about your experience working as a <job_title> at <company>? I see you have experience in <technologies>, which aligns well with the requirements for this role. Could you elaborate on your role and responsibilities?
    ```
  - Example for the candidate:
    ```yaml
    I worked as a <job_title> at <company>, where I was responsible for <responsibilities>. I used <technologies> to develop <specific_projects>. My experience in <specific_skills> helped me achieve <specific_results>.
    ```

#### Node: **`application_prompt`**

- **Purpose**: Prompts the candidate to apply for the job.
- **Initiator**: The agent.
- **Actions**:
  - The agent prompts the candidate to apply using a `template`.
  - The candidate responds, using a `template`, indicating whether they want to apply (`yes`) or not (`no`).
  - Example for the agent:
    ```yaml
    Based on your experience, I believe you would be a good fit for the role. Would you like to apply for the position?
    ```
- **Branching**: 
  - If the candidate says "yes," the flow moves to `additional_questions`.
  - If the candidate says "no," the flow moves to `goodbye`.

#### Node: **`additional_questions`**

- **Purpose**: Invites the candidate to ask any additional questions they may have about the role.
- **Initiator**: The agent.
- **Actions**:
  - The agent asks if the candidate has questions using a `template`.
  - The candidate responds using a `template` or `message` depending on whether they have questions.
- **Branching**:
  - If the candidate has questions, the flow moves to `additional_questions_followup`.
  - If the candidate does not have questions, the flow moves to `application_portal`.

#### Node: **`goodbye`**

- **Purpose**: Ends the conversation with a closing message.
- **Initiator**: The agent.
- **Actions**:
  - The agent sends a final `message` thanking the candidate and closing the conversation.
  - Example:
    ```yaml
    Thank you for your time {candidate[first_name]}. If you have any more questions, feel free to reach out. Have a great day!
    ```
